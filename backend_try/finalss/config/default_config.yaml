# ==================================================================================
# default_config.yaml - 전체 설정 파일 (새로운 5막 워크플로우)
# ==================================================================================

# --- 스토리 구조 설정 ---
story:
  initial_context: "흥부는 욕심쟁이 형 놀부에게 쫓겨나 비가 새는 허름한 집에 살고 있습니다. 흥부는 가족들을 위해 무언가를 해야만 합니다."
  total_stages: 5
  scenes_per_stage: 3
  
  structure:
    1:
      name: "발단"
      description: "이야기의 시작, 배경과 인물 소개"
    2:
      name: "전개"
      description: "사건이 본격적으로 전개되기 시작"
    3:
      name: "위기"
      description: "주인공이 어려움에 직면"
    4:
      name: "절정"
      description: "갈등이 최고조에 달하고 전환점 발생"
    5:
      name: "결말"
      description: "이야기의 마무리와 교훈"
  
  original_refs:
    1: |
      옛날 옛날에 흥부와 놀부라는 형제가 살았습니다. 놀부는 욕심쟁이였고 흥부는 착했습니다.
      아버지가 돌아가시자 놀부는 흥부를 빈손으로 쫓아냈습니다.
      흥부 가족은 가난에 시달리며 힘들게 살았습니다.
    2: |
      흥부 가족은 가난에 시달리며 힘들게 살았습니다. 흥부가 놀부에게 쌀을 구하러 갔지만 매만 맞고 쫓겨났습니다.
      어느 봄날, 흥부는 다리가 부러진 제비를 고쳐주었습니다.
    3: |
      흥부가 놀부에게 매만 맞고 쫓겨났습니다.
      어느 봄날, 흥부는 다리가 부러진 제비를 고쳐주었습니다.
    4: |
      제비는 이듬해 봄, 박씨를 물어왔습니다. 흥부가 박을 타자 금은보화가 쏟아져 부자가 되었습니다.
      배가 아픈 놀부는 일부러 제비 다리를 부러뜨리고 고쳐주었습니다.
    5: |
      놀부의 박에서는 도깨비가 나와 놀부를 혼내고 재산을 다 가져갔습니다.
      흥부는 거지가 된 놀부를 도와주었고, 형제는 화해하고 행복하게 살았습니다.

# --- 캐릭터 고정값 (NEW: 일관성 강화) ---
characters:
  # 공통 아트 스타일
  art_style: "Pixar 3D animation style, soft lighting, warm colors"
  
  # 흥부 고정값
  heungbu:
    name: "Heungbu"
    name_kr: "흥부"
    ratio: "head-to-body ratio 1:6, slim adult male build"
    costume: "light blue worn-out hanbok with patches"
    features: "gentle round eyes, kind warm smile, light brown straw hat (삿갓)"
    full_prompt: "Pixar 3D style, adult male, head-to-body ratio 1:6, slim build, light blue worn-out hanbok with patches, gentle round eyes, kind warm smile, light brown straw hat"
  
  # 놀부 고정값
  nolbu:
    name: "Nolbu"
    name_kr: "놀부"
    ratio: "head-to-body ratio 1:5, stocky chubby build"
    costume: "dark navy expensive silk hanbok"
    features: "sharp angular eyes, stern frown, tall black traditional hat (검은 갓), thin mustache"
    full_prompt: "Pixar 3D style, adult male, head-to-body ratio 1:5, stocky chubby build, dark navy expensive silk hanbok, sharp angular eyes, stern frown, tall black traditional hat, thin mustache"
  
  # 흥부 아내 고정값
  heungbu_wife:
    name: "Heungbu Wife"
    name_kr: "흥부 아내"
    ratio: "head-to-body ratio 1:6, slender adult female build"
    costume: "faded pink jeogori and gray chima"
    features: "warm gentle eyes, caring expression, hair in a simple bun"
    full_prompt: "Pixar 3D style, adult female, head-to-body ratio 1:6, slender build, faded pink jeogori and gray chima, warm gentle eyes, caring expression, hair in simple bun"
  
  # 아이들 고정값
  children:
    name: "Children"
    name_kr: "아이들"
    ratio: "head-to-body ratio 1:4, small child proportions"
    costume: "simple white and beige hanbok"
    features: "big round curious eyes, cheerful expressions"
    full_prompt: "Pixar 3D style, children, head-to-body ratio 1:4, small child proportions, simple white and beige hanbok, big round curious eyes, cheerful expressions"

# --- TTS 설정 (NEW: 20초 글자수 제한) ---
tts:
  target_duration: 21      # 목표 TTS 길이 (초) - 사용 안 함
  silence_padding: 0       # 뒤에 추가할 무음 (초) - 사용 안 함
  total_duration: 23       # 최종 오디오 길이 (초)
  target_chars: 160        # 목표 글자수
  min_chars: 150           # 최소 글자수
  max_chars: 170           # 최대 글자수
  
  # 자동 조정 설정
  auto_adjust: true        # 자동 길이 조정 활성화
  target_min_duration: 21  # 최소 목표 (초)
  target_max_duration: 23  # 최대 목표 (초)
  max_retries: 3           # 최대 재시도 횟수
  chars_per_second: 7.43   # 글자수/초 비율

# --- 미디어 생성 설정 ---
media:
  art_style: |
    **CRITICAL: Use Pixar 3D animation style consistently**
    - Visual Style: Pixar 3D animation, cinematic lighting, high contrast, rich textures
    - Atmosphere: Dynamic environment (wind blowing, dust particles, shifting light, moving leaves)
    - Camera: Cinematic angles, depth of field, slight handheld movement
    - Character Proportions: MUST follow exact ratios specified for each character
    - Background: Detailed, alive with motion elements
    - Mood: Family-friendly but dramatic and immersive
    - **NO TEXT, NO LABELS in image**
    - **G-rated, non-violent content only**
  
  models:
    image: "gemini-2.5-flash-image"
    video: "veo-3.1-generate-preview"
    text: "gemini-2.5-flash"
  
  tts:
    voice_id: "ksaI0TCD9BstzEzlxj4q"
    model_id: "eleven_multilingual_v2"
  
  video:
    crossfade_duration: 0.5
    fps: 24
    codec: "libx264"
    crf: 23
    preset: "medium"
    scene_duration: 8
    stage_duration: 23

# --- 영상 필터링 우회 (NEW: 순화 매핑) ---
content_filter:
  # 폭력적 표현 → 순화된 표현 매핑
  sanitize_mappings:
    "쫓아내다": "문을 가리키며 나가라고 말하다"
    "쫓겨나다": "슬프게 집을 떠나다"
    "때리다": "화난 표정으로 손을 흔들다"
    "맞다": "놀부 앞에서 고개를 숙이다"
    "부러지다": "다친 상태로 발견되다"
    "부러뜨리다": "다치게 하다"
    "혼내다": "놀라게 하다"
    "벌을 받다": "놀란 표정으로 뒤로 물러나다"
    "울다": "슬픈 표정을 짓다"
    "고통": "힘든 상황"
  
  # 금지 단어 (video_motion에서 제외)
  blocked_words:
    - "violence"
    - "hit"
    - "strike"
    - "break"
    - "cry"
    - "pain"
    - "suffer"
    - "blood"
    - "hurt"
    - "attack"

# --- 파일 경로 설정 ---
paths:
  output_base: "output"
  stages: "output/stages"
  tts: "output/tts"
  final: "output/final"
  temp: "output/temp"
  characters: "config/characters"
  state_file: "output/state.json"
  progress_file: "output/story_progress.json"
  final_story_file: "output/final/complete_story.txt"
  final_video_file: "output/final/heungbu_complete.mp4"
  final_tts_file: "output/final/heungbu_full_story.mp3"

# --- 재시도 설정 ---
retry:
  max_attempts: 3
  backoff: "exponential"
  base_delay: 2
  retryable_codes: [429, 500, 503]

# --- 파일명 패턴 ---
file_patterns:
  stage_image: "stage_{stage}_image_{scene}.png"
  stage_video: "stage_{stage}_video_{scene}.mp4"
  stage_merged_video: "stage_{stage}_merged.mp4"
  stage_tts: "stage_{stage}_tts.mp3"
  stage_tts_padded: "stage_{stage}_tts_padded.mp3"
  stage_final: "stage_{stage}_final.mp4"
  character_ref: "character_{name}_ref.png"